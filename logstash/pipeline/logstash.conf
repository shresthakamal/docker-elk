input {
	beats {
		port => 5044
	}

	tcp {
		port => 50000
	}
}

## Add your filters / logstash plugins configuration here
filter {
	# Parse Docker container logs
	if [container][name] {
		mutate {
			add_field => { "container_name" => "%{[container][name]}" }
		}
	}

	# Add timestamp parsing for better time handling
	if [log][file][path] {
		mutate {
			add_field => { "log_source" => "%{[log][file][path]}" }
		}
	}

	# Parse JSON logs if they exist
	if [message] =~ /^\{.*\}$/ {
		json {
			source => "message"
		}
	}
}

output {
	elasticsearch {
		hosts => "elasticsearch:9200"
		user => "logstash_internal"
		password => "${LOGSTASH_INTERNAL_PASSWORD}"
		# Create index pattern based on input source
		index => "filebeat-%{+YYYY.MM.dd}"
		# Allow Logstash to manage index templates and creation
		manage_template => true
		template_overwrite => true
	}

	# Optional: Output to stdout for debugging
	# stdout { codec => rubydebug }
}
